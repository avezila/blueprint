/*
 * Copyright 2015 Palantir Technologies, Inc. All rights reserved.
 * Licensed under the BSD-3 License as modified (the “License”); you may obtain a copy
 * of the license at https://github.com/palantir/blueprint/blob/master/LICENSE
 * and https://github.com/palantir/blueprint/blob/master/PATENTS
 */
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var core_1 = require("@blueprintjs/core");
var classNames = require("classnames");
var React = require("react");
var Classes = require("./common/classes");
var Utils = require("./common/utils");
var DatePickerCaption = (function (_super) {
    __extends(DatePickerCaption, _super);
    function DatePickerCaption() {
        var _this = this;
        _super.apply(this, arguments);
        this.containerRefHandler = function (r) { return _this.containerElement = r; };
        this.monthArrowRefHandler = function (r) { return _this.monthArrowElement = r; };
        this.yearArrowRefHandler = function (r) { return _this.yearArrowElement = r; };
        this.handleMonthSelectChange = function (e) {
            var month = parseInt(e.target.value, 10);
            core_1.Utils.safeInvoke(_this.props.onMonthChange, month);
        };
        this.handleYearSelectChange = function (e) {
            var year = parseInt(e.target.value, 10);
            core_1.Utils.safeInvoke(_this.props.onYearChange, year);
        };
    }
    DatePickerCaption.prototype.render = function () {
        var _a = this.props, date = _a.date, locale = _a.locale, localeUtils = _a.localeUtils, minDate = _a.minDate, maxDate = _a.maxDate;
        var minYear = minDate.getFullYear();
        var maxYear = maxDate.getFullYear();
        var displayMonth = date.getMonth();
        var displayYear = date.getFullYear();
        // build the list of available months, limiting based on minDate and maxDate as necessary
        var months = localeUtils.getMonths(locale);
        var startMonth = (displayYear === minYear) ? minDate.getMonth() : 0;
        var endMonth = (displayYear === maxYear) ? maxDate.getMonth() + 1 : undefined;
        var monthOptionElements = months.map(function (name, i) {
            return React.createElement("option", {key: i, value: i.toString()}, name);
        }).slice(startMonth, endMonth);
        var years = [minYear];
        for (var year = minYear + 1; year <= maxYear; ++year) {
            years.push(year);
        }
        var yearOptionElements = years.map(function (year, i) {
            return React.createElement("option", {key: i, value: year.toString()}, year);
        });
        // allow out-of-bounds years but disable the option. this handles the Dec 2016 case in #391.
        if (displayYear > maxYear) {
            yearOptionElements.push(React.createElement("option", {key: "next", disabled: true, value: displayYear.toString()}, displayYear));
        }
        this.displayedMonthText = months[displayMonth];
        this.displayedYearText = displayYear.toString();
        var caretClasses = classNames("pt-icon-standard", "pt-icon-caret-down", Classes.DATEPICKER_CAPTION_CARET);
        return (React.createElement("div", {className: Classes.DATEPICKER_CAPTION, ref: this.containerRefHandler}, 
            React.createElement("div", {className: Classes.DATEPICKER_CAPTION_SELECT}, 
                React.createElement("select", {className: Classes.DATEPICKER_MONTH_SELECT, onChange: this.handleMonthSelectChange, value: displayMonth.toString()}, monthOptionElements), 
                React.createElement("span", {className: caretClasses, ref: this.monthArrowRefHandler})), 
            React.createElement("div", {className: Classes.DATEPICKER_CAPTION_SELECT}, 
                React.createElement("select", {className: Classes.DATEPICKER_YEAR_SELECT, onChange: this.handleYearSelectChange, value: displayYear.toString()}, yearOptionElements), 
                React.createElement("span", {className: caretClasses, ref: this.yearArrowRefHandler}))));
    };
    DatePickerCaption.prototype.componentDidMount = function () {
        this.positionArrows();
    };
    DatePickerCaption.prototype.componentDidUpdate = function () {
        this.positionArrows();
    };
    DatePickerCaption.prototype.positionArrows = function () {
        // pass our container element to the measureTextWidth utility to ensure
        // that we're measuring the width of text as sized within this component.
        var textClass = "pt-datepicker-caption-measure";
        var monthWidth = Utils.measureTextWidth(this.displayedMonthText, textClass, this.containerElement);
        this.monthArrowElement.setAttribute("style", "left:" + monthWidth);
        var yearWidth = Utils.measureTextWidth(this.displayedYearText, textClass, this.containerElement);
        this.yearArrowElement.setAttribute("style", "left:" + yearWidth);
    };
    return DatePickerCaption;
}(React.Component));
exports.DatePickerCaption = DatePickerCaption;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9kYXRlUGlja2VyQ2FwdGlvbi50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7O0dBS0c7Ozs7Ozs7QUFFSCxxQkFBd0MsbUJBQW1CLENBQUMsQ0FBQTtBQUM1RCxJQUFZLFVBQVUsV0FBTSxZQUFZLENBQUMsQ0FBQTtBQUN6QyxJQUFZLEtBQUssV0FBTSxPQUFPLENBQUMsQ0FBQTtBQUUvQixJQUFZLE9BQU8sV0FBTSxrQkFBa0IsQ0FBQyxDQUFBO0FBQzVDLElBQVksS0FBSyxXQUFNLGdCQUFnQixDQUFDLENBQUE7QUFpQnhDO0lBQXVDLHFDQUE0QztJQUFuRjtRQUFBLGlCQTRHQztRQTVHc0MsOEJBQTRDO1FBb0Z2RSx3QkFBbUIsR0FBRyxVQUFDLENBQWMsSUFBSyxPQUFBLEtBQUksQ0FBQyxnQkFBZ0IsR0FBRyxDQUFDLEVBQXpCLENBQXlCLENBQUM7UUFDcEUseUJBQW9CLEdBQUcsVUFBQyxDQUFjLElBQUssT0FBQSxLQUFJLENBQUMsaUJBQWlCLEdBQUcsQ0FBQyxFQUExQixDQUEwQixDQUFDO1FBQ3RFLHdCQUFtQixHQUFHLFVBQUMsQ0FBYyxJQUFLLE9BQUEsS0FBSSxDQUFDLGdCQUFnQixHQUFHLENBQUMsRUFBekIsQ0FBeUIsQ0FBQztRQWFwRSw0QkFBdUIsR0FBRyxVQUFDLENBQXFDO1lBQ3BFLElBQU0sS0FBSyxHQUFHLFFBQVEsQ0FBRSxDQUFDLENBQUMsTUFBNEIsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDbEUsWUFBYyxDQUFDLFVBQVUsQ0FBQyxLQUFJLENBQUMsS0FBSyxDQUFDLGFBQWEsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUMvRCxDQUFDLENBQUE7UUFFTywyQkFBc0IsR0FBRyxVQUFDLENBQXFDO1lBQ25FLElBQU0sSUFBSSxHQUFHLFFBQVEsQ0FBRSxDQUFDLENBQUMsTUFBNEIsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDakUsWUFBYyxDQUFDLFVBQVUsQ0FBQyxL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LENBQUM7UUFDbkcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsVUFBUSxTQUFXLENBQUMsQ0FBQztJQUNyRSxDQUFDO0lBV0wsd0JBQUM7QUFBRCxDQTVHQSxBQTRHQyxDQTVHc0MsS0FBSyxDQUFDLFNBQVMsR0E0R3JEO0FBNUdZLHlCQUFpQixvQkE0RzdCLENBQUEiLCJmaWxlIjoiZGF0ZVBpY2tlckNhcHRpb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IDIwMTUgUGFsYW50aXIgVGVjaG5vbG9naWVzLCBJbmMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQlNELTMgTGljZW5zZSBhcyBtb2RpZmllZCAodGhlIOKAnExpY2Vuc2XigJ0pOyB5b3UgbWF5IG9idGFpbiBhIGNvcHlcbiAqIG9mIHRoZSBsaWNlbnNlIGF0IGh0dHBzOi8vZ2l0aHViLmNvbS9wYWxhbnRpci9ibHVlcHJpbnQvYmxvYi9tYXN0ZXIvTElDRU5TRVxuICogYW5kIGh0dHBzOi8vZ2l0aHViLmNvbS9wYWxhbnRpci9ibHVlcHJpbnQvYmxvYi9tYXN0ZXIvUEFURU5UU1xuICovXG5cbmltcG9ydCB7IFV0aWxzIGFzIEJsdWVwcmludFV0aWxzIH0gZnJvbSBcIkBibHVlcHJpbnRqcy9jb3JlXCI7XG5pbXBvcnQgKiBhcyBjbGFzc05hbWVzIGZyb20gXCJjbGFzc25hbWVzXCI7XG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tIFwicmVhY3RcIjtcblxuaW1wb3J0ICogYXMgQ2xhc3NlcyBmcm9tIFwiLi9jb21tb24vY2xhc3Nlc1wiO1xuaW1wb3J0ICogYXMgVXRpbHMgZnJvbSBcIi4vY29tbW9uL3V0aWxzXCI7XG5pbXBvcnQgeyBJRGF0ZVBpY2tlckxvY2FsZVV0aWxzIH0gZnJvbSBcIi4vZGF0ZVBpY2tlckNvcmVcIjtcblxuZXhwb3J0IGludGVyZmFjZSBJRGF0ZVBpY2tlckNhcHRpb25Qcm9wcyB7XG4gICAgbWF4RGF0ZTogRGF0ZTtcbiAgICBtaW5EYXRlOiBEYXRlO1xuICAgIG9uTW9udGhDaGFuZ2U/OiAobW9udGg6IG51bWJlcikgPT4gdm9pZDtcbiAgICBvblllYXJDaGFuZ2U/OiAoeWVhcjogbnVtYmVyKSA9PiB2b2lkO1xuXG4gICAgLy8gbm9ybWFsbHkgd2UgY291bGQgZXh0ZW5kIFJlYWN0RGF5UGlja2VyLkNhcHRpb25FbGVtZW50UHJvcHMsXG4gICAgLy8gYnV0IHdlIGRvbid0IHdhbnQgdG8gaW50cm9kdWNlIGEgdHlwaW5nIGRlcGVuZGVuY3ksIHNvIG1hbnVhbGx5IGFkZCBwcm9wcyBoZXJlXG4gICAgZGF0ZT86IERhdGU7XG4gICAgbG9jYWxlVXRpbHM/OiBJRGF0ZVBpY2tlckxvY2FsZVV0aWxzO1xuICAgIGxvY2FsZT86IHN0cmluZztcbiAgICBvbkNsaWNrPzogUmVhY3QuTW91c2VFdmVudEhhbmRsZXI8SFRNTEVsZW1lbnQ+O1xufVxuXG5leHBvcnQgY2xhc3MgRGF0ZVBpY2tlckNhcHRpb24gZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8SURhdGVQaWNrZXJDYXB0aW9uUHJvcHMsIHt9PiB7XG4gICAgcHJpdmF0ZSBkaXNwbGF5ZWRNb250aFRleHQ6IHN0cmluZztcbiAgICBwcml2YXRlIGRpc3BsYXllZFllYXJUZXh0OiBzdHJpbmc7XG5cbiAgICBwcml2YXRlIGNvbnRhaW5lckVsZW1lbnQ6IEhUTUxFbGVtZW50O1xuICAgIHByaXZhdGUgbW9udGhBcnJvd0VsZW1lbnQ6IEhUTUxFbGVtZW50O1xuICAgIHByaXZhdGUgeWVhckFycm93RWxlbWVudDogSFRNTEVsZW1lbnQ7XG5cbiAgICBwdWJsaWMgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGRhdGUsIGxvY2FsZSwgbG9jYWxlVXRpbHMsIG1pbkRhdGUsIG1heERhdGUgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IG1pblllYXIgPSBtaW5EYXRlLmdldEZ1bGxZZWFyKCk7XG4gICAgICAgIGNvbnN0IG1heFllYXIgPSBtYXhEYXRlLmdldEZ1bGxZZWFyKCk7XG4gICAgICAgIGNvbnN0IGRpc3BsYXlNb250aCA9IGRhdGUuZ2V0TW9udGgoKTtcbiAgICAgICAgY29uc3QgZGlzcGxheVllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCk7XG5cbiAgICAgICAgLy8gYnVpbGQgdGhlIGxpc3Qgb2YgYXZhaWxhYmxlIG1vbnRocywgbGltaXRpbmcgYmFzZWQgb24gbWluRGF0ZSBhbmQgbWF4RGF0ZSBhcyBuZWNlc3NhcnlcbiAgICAgICAgY29uc3QgbW9udGhzID0gbG9jYWxlVXRpbHMuZ2V0TW9udGhzKGxvY2FsZSk7XG4gICAgICAgIGNvbnN0IHN0YXJ0TW9udGggPSAoZGlzcGxheVllYXIgPT09IG1pblllYXIpID8gbWluRGF0ZS5nZXRNb250aCgpIDogMDtcbiAgICAgICAgY29uc3QgZW5kTW9udGggPSAoZGlzcGxheVllYXIgPT09IG1heFllYXIpID8gbWF4RGF0ZS5nZXRNb250aCgpICsgMSA6IHVuZGVmaW5lZDtcbiAgICAgICAgY29uc3QgbW9udGhPcHRpb25FbGVtZW50cyA9IG1vbnRocy5tYXAoKG5hbWUsIGkpID0+IHtcbiAgICAgICAgICAgIHJldHVybiA8b3B0aW9uIGtleT17aX0gdmFsdWU9e2kudG9TdHJpbmcoKX0+e25hbWV9PC9vcHRpb24+O1xuICAgICAgICB9KS5zbGljZShzdGFydE1vbnRoLCBlbmRNb250aCk7XG5cbiAgICAgICAgY29uc3QgeWVhcnMgPSBbbWluWWVhcl07XG4gICAgICAgIGZvciAobGV0IHllYXIgPSBtaW5ZZWFyICsgMTsgeWVhciA8PSBtYXhZZWFyOyArK3llYXIpIHtcbiAgICAgICAgICAgIHllYXJzLnB1c2goeWVhcik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeWVhck9wdGlvbkVsZW1lbnRzID0geWVhcnMubWFwKCh5ZWFyLCBpKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gPG9wdGlvbiBrZXk9e2l9IHZhbHVlPXt5ZWFyLnRvU3RyaW5nKCl9Pnt5ZWFyfTwvb3B0aW9uPjtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIGFsbG93IG91dC1vZi1ib3VuZHMgeWVhcnMgYnV0IGRpc2FibGUgdGhlIG9wdGlvbi4gdGhpcyBoYW5kbGVzIHRoZSBEZWMgMjAxNiBjYXNlIGluICMzOTEuXG4gICAgICAgIGlmIChkaXNwbGF5WWVhciA+IG1heFllYXIpIHtcbiAgICAgICAgICAgIHllYXJPcHRpb25FbGVtZW50cy5wdXNoKFxuICAgICAgICAgICAgICAgIDxvcHRpb24ga2V5PVwibmV4dFwiIGRpc2FibGVkIHZhbHVlPXtkaXNwbGF5WWVhci50b1N0cmluZygpfT57ZGlzcGxheVllYXJ9PC9vcHRpb24+LFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZGlzcGxheWVkTW9udGhUZXh0ID0gbW9udGhzW2Rpc3BsYXlNb250aF07XG4gICAgICAgIHRoaXMuZGlzcGxheWVkWWVhclRleHQgPSBkaXNwbGF5WWVhci50b1N0cmluZygpO1xuXG4gICAgICAgIGNvbnN0IGNhcmV0Q2xhc3NlcyA9IGNsYXNzTmFtZXMoXCJwdC1pY29uLXN0YW5kYXJkXCIsIFwicHQtaWNvbi1jYXJldC1kb3duXCIsIENsYXNzZXMuREFURVBJQ0tFUl9DQVBUSU9OX0NBUkVUKTtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9e0NsYXNzZXMuREFURVBJQ0tFUl9DQVBUSU9OfVxuICAgICAgICAgICAgICAgIHJlZj17dGhpcy5jb250YWluZXJSZWZIYW5kbGVyfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtDbGFzc2VzLkRBVEVQSUNLRVJfQ0FQVElPTl9TRUxFQ1R9PlxuICAgICAgICAgICAgICAgICAgICA8c2VsZWN0XG4gICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e0NsYXNzZXMuREFURVBJQ0tFUl9NT05USF9TRUxFQ1R9XG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5oYW5kbGVNb250aFNlbGVjdENoYW5nZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXtkaXNwbGF5TW9udGgudG9TdHJpbmcoKX1cbiAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAge21vbnRoT3B0aW9uRWxlbWVudHN9XG4gICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PlxuICAgICAgICAgICAgICAgICAgICA8c3BhblxuICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjYXJldENsYXNzZXN9XG4gICAgICAgICAgICAgICAgICAgICAgICByZWY9e3RoaXMubW9udGhBcnJvd1JlZkhhbmRsZXJ9XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e0NsYXNzZXMuREFURVBJQ0tFUl9DQVBUSU9OX1NFTEVDVH0+XG4gICAgICAgICAgICAgICAgICAgIDxzZWxlY3RcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17Q2xhc3Nlcy5EQVRFUElDS0VSX1lFQVJfU0VMRUNUfVxuICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMuaGFuZGxlWWVhclNlbGVjdENoYW5nZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXtkaXNwbGF5WWVhci50b1N0cmluZygpfVxuICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICB7eWVhck9wdGlvbkVsZW1lbnRzfVxuICAgICAgICAgICAgICAgICAgICA8L3NlbGVjdD5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17Y2FyZXRDbGFzc2VzfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVmPXt0aGlzLnllYXJBcnJvd1JlZkhhbmRsZXJ9XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICAgIHRoaXMucG9zaXRpb25BcnJvd3MoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY29tcG9uZW50RGlkVXBkYXRlKCkge1xuICAgICAgICB0aGlzLnBvc2l0aW9uQXJyb3dzKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjb250YWluZXJSZWZIYW5kbGVyID0gKHI6IEhUTUxFbGVtZW50KSA9PiB0aGlzLmNvbnRhaW5lckVsZW1lbnQgPSByO1xuICAgIHByaXZhdGUgbW9udGhBcnJvd1JlZkhhbmRsZXIgPSAocjogSFRNTEVsZW1lbnQpID0+IHRoaXMubW9udGhBcnJvd0VsZW1lbnQgPSByO1xuICAgIHByaXZhdGUgeWVhckFycm93UmVmSGFuZGxlciA9IChyOiBIVE1MRWxlbWVudCkgPT4gdGhpcy55ZWFyQXJyb3dFbGVtZW50ID0gcjtcblxuICAgIHByaXZhdGUgcG9zaXRpb25BcnJvd3MoKSB7XG4gICAgICAgIC8vIHBhc3Mgb3VyIGNvbnRhaW5lciBlbGVtZW50IHRvIHRoZSBtZWFzdXJlVGV4dFdpZHRoIHV0aWxpdHkgdG8gZW5zdXJlXG4gICAgICAgIC8vIHRoYXQgd2UncmUgbWVhc3VyaW5nIHRoZSB3aWR0aCBvZiB0ZXh0IGFzIHNpemVkIHdpdGhpbiB0aGlzIGNvbXBvbmVudC5cbiAgICAgICAgY29uc3QgdGV4dENsYXNzID0gXCJwdC1kYXRlcGlja2VyLWNhcHRpb24tbWVhc3VyZVwiO1xuICAgICAgICBjb25zdCBtb250aFdpZHRoID0gVXRpbHMubWVhc3VyZVRleHRXaWR0aCh0aGlzLmRpc3BsYXllZE1vbnRoVGV4dCwgdGV4dENsYXNzLCB0aGlzLmNvbnRhaW5lckVsZW1lbnQpO1xuICAgICAgICB0aGlzLm1vbnRoQXJyb3dFbGVtZW50LnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIGBsZWZ0OiR7bW9udGhXaWR0aH1gKTtcblxuICAgICAgICBjb25zdCB5ZWFyV2lkdGggPSBVdGlscy5tZWFzdXJlVGV4dFdpZHRoKHRoaXMuZGlzcGxheWVkWWVhclRleHQsIHRleHRDbGFzcywgdGhpcy5jb250YWluZXJFbGVtZW50KTtcbiAgICAgICAgdGhpcy55ZWFyQXJyb3dFbGVtZW50LnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIGBsZWZ0OiR7eWVhcldpZHRofWApO1xuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlTW9udGhTZWxlY3RDaGFuZ2UgPSAoZTogUmVhY3QuRm9ybUV2ZW50PEhUTUxTZWxlY3RFbGVtZW50PikgPT4ge1xuICAgICAgICBjb25zdCBtb250aCA9IHBhcnNlSW50KChlLnRhcmdldCBhcyBIVE1MU2VsZWN0RWxlbWVudCkudmFsdWUsIDEwKTtcbiAgICAgICAgQmx1ZXByaW50VXRpbHMuc2FmZUludm9rZSh0aGlzLnByb3BzLm9uTW9udGhDaGFuZ2UsIG1vbnRoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGhhbmRsZVllYXJTZWxlY3RDaGFuZ2UgPSAoZTogUmVhY3QuRm9ybUV2ZW50PEhUTUxTZWxlY3RFbGVtZW50PikgPT4ge1xuICAgICAgICBjb25zdCB5ZWFyID0gcGFyc2VJbnQoKGUudGFyZ2V0IGFzIEhUTUxTZWxlY3RFbGVtZW50KS52YWx1ZSwgMTApO1xuICAgICAgICBCbHVlcHJpbnRVdGlscy5zYWZlSW52b2tlKHRoaXMucHJvcHMub25ZZWFyQ2hhbmdlLCB5ZWFyKTtcbiAgICB9XG59XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
